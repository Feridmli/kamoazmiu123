name: Seaport & NFT Metadata Sync

on:
  workflow_dispatch:        # Manual iÅŸÉ™ salmaq Ã¼Ã§Ã¼n
  schedule:
    - cron: "0 * * * *"     # HÉ™r 1 saatda (Seaport Sync)
    - cron: "*/5 * * * *"   # HÉ™r 5 dÉ™qiqÉ™dÉ™ (NFT Metadata Sync)

jobs:
  sync:
    runs-on: ubuntu-latest

    steps:
      # ------------------------------
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: 20

      - name: Install dependencies
        run: npm install

      # ------------------------------
      # ðŸš€ SAATDA BÄ°R --> Seaport Order Sync
      - name: Run ApeChain Seaport Sync (hourly)
        if: github.event.schedule == '0 * * * *'
        env:
          SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          SUPABASE_SERVICE_ROLE_KEY: ${{ secrets.SUPABASE_SERVICE_ROLE_KEY }}
          NFT_CONTRACT_ADDRESS: ${{ secrets.NFT_CONTRACT_ADDRESS }}
          SEAPORT_CONTRACT_ADDRESS: ${{ secrets.SEAPORT_CONTRACT_ADDRESS }}
          BACKEND_URL: ${{ secrets.BACKEND_URL }}
          APECHAIN_RPC: ${{ secrets.APECHAIN_RPC }}
          FROM_BLOCK: ${{ secrets.FROM_BLOCK }}
        run: |
          echo "â° Running Seaport Sync (every 1 hour)"
          node syncSeaportOrders.js

      # ------------------------------
      # ðŸš€ 5 DÆQÄ°QÆDÆ BÄ°R --> NFT Metadata + Owner Sync
      - name: Run NFT Metadata Sync (5 mins)
        if: github.event.schedule == '*/5 * * * *'
        env:
          SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          SUPABASE_SERVICE_ROLE_KEY: ${{ secrets.SUPABASE_SERVICE_ROLE_KEY }}
          NFT_CONTRACT_ADDRESS: ${{ secrets.NFT_CONTRACT_ADDRESS }}
          APECHAIN_RPC: ${{ secrets.APECHAIN_RPC }}
        run: |
          echo "ðŸ”„ Running NFT Metadata Sync (every 5 minutes)"
          node syncNFTMetadata.js
